(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.canvastext = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var canvastext,drawtext,fontHeight,textSelection;fontHeight=require("./fontHeight"),textSelection=require("./selectedText"),drawtext=function(e,t,n,r,a){var i,c,l,o,s,h;for(s=fontHeight("font: "+t.font),h=[],i=c=0,l=a.length;l>c;i=++c)o=a[i],h.push(t.fillText(o,n,r+(i+1)*s));return h},canvastext=function(e){return function(){var t,n,r,a,i,c,l,o,s,h,u,f,d,v,g,m,p,y,x,b,w;return t=e.canvas,n=e.canvas.getContext("2d"),a={x:e.x,y:e.y,w:e.width,h:e.height},r={line:0,character:0},w=textSelection(),h=(e.text||"").split("\n"),s=fontHeight("font: "+n.font),p=function(){var i,c;return i=!0,c=Date.now(),function(l,o){var u,f;return null==l&&(l=!0),null==o&&(o=!1),s=fontHeight("font: "+n.font),null!=e.clearContext?e.clearContext():n.clearRect(a.x,a.y,a.w,a.h),drawtext(t,n,a.x,a.y,h),w.mark(t,n,a.x,a.y,h),(o||l&&i)&&(u=a.x+n.measureText(h[r.line].substr(0,r.character)).width,f=a.y+r.line*s,n.beginPath(),n.moveTo(u,f),n.lineTo(u,f+s),n.stroke()),o||Date.now()-c>=450?(i=!i||o,c=Date.now()):void 0}}(),y=setInterval(p,500),l=function(e){return w.isEmpty()||m(),h[r.line]=h[r.line].slice(0,r.character)+e+h[r.line].substr(r.character),r.character++,p()},m=function(){var e,t,n;try{return t=w.normalize(),n=t.start,e=t.end,h[n.line]=h[n.line].substr(0,n.character)+h[e.line].substr(e.character),e.line>n.line&&h.splice(n.line+1,e.line-n.line),r=n,x(),p(!0,!0)}catch(a){}},g=function(){var e,t,n,a;if(!w.isEmpty())return m();if(r.character>0)return r.character--,h[r.line]=h[r.line].slice(0,r.character)+h[r.line].substr(r.character+1),p(!0,!0);if(r.line>0){for(r.line--,r.character=h[r.line].length,h[r.line]+=h[r.line+1],e=t=n=r.line+1,a=h.length-1;a>=n?a>t:t>a;e=a>=n?++t:--t)h[e]=h[e+1];return h.pop(),p(!0,!0)}},i=function(){var e,t,n,a;if(!w.isEmpty())return m();if(r.character<h[r.line].length)return h[r.line]=h[r.line].slice(0,r.character)+h[r.line].substr(r.character+1),p(!0,!0);if(r.line<h.length-1){for(h[r.line]+=h[r.line+1],e=t=n=r.line+1,a=h.length-1;a>=n?a>t:t>a;e=a>=n?++t:--t)h[e]=h[e+1];return h.pop(),p(!0,!0)}},o=function(){return w.isEmpty()||m(),r.line++,h.splice(r.line,0,h[r.line-1].substr(r.character)),h[r.line-1]=h[r.line-1].slice(0,r.character),r.character=0,p()},f=function(e,t){var n;switch(n={line:r.line,character:r.character},e){case"up":r.line>0&&(r.line--,r.character=Math.min(h[r.line].length,r.character));break;case"down":r.line<h.length-1?(r.line++,r.character=Math.min(h[r.line].length,r.character)):r.character=h[r.line].length;break;case"left":r.character>0?r.character--:r.line>0&&(r.line--,r.character=h[r.line].length);break;case"right":r.character<h[r.line].length?r.character++:r.line<h.length-1&&(r.line++,r.character=0);break;case"lineStart":r.character=0;break;case"start":r.character=0,r.line=0;break;case"lineEnd":r.character=h[r.line].length;break;case"end":r.line=h.length-1,r.character=h[r.line].length}return t?w.setEnd(r):(w.isEmpty()||(r.character=n.character,r.line=n.line),x()),p(!0,!0)},x=function(){return w.setStart(r),w.setEnd(r)},b=function(){var e;return w.setStart({line:0,character:0}),e={line:h.length-1,character:h[h.length-1].length},w.setEnd(e),r=e,p(!0,!0)},c=function(e,t){var r,i;for(i=Math.min(h.length-1,Math.max(0,Math.floor((t-a.y)/s))),r=0;r<h[i].length&&a.x+n.measureText(h[i].substr(0,r+1)).width<=e;)r++;return{line:i,character:r}},u=function(){var e;return e=!1,{down:function(n){return r=c(n.pageX-t.offsetLeft,n.pageY-t.offsetTop),w.setStart(r),w.setEnd(r),p(!0,!0),e=!0},move:function(n){return e?(r=c(n.pageX-t.offsetLeft,n.pageY-t.offsetTop),w.setEnd(r),p(!0,!0)):void 0},up:function(t){return e=!1}}}(),v=function(t){return l(String.fromCharCode(t.keyCode||t.which)),null!=e.onChange?e.onChange(h):void 0},d=function(t){var n;switch(n=t.keyCode||t.which){case 8:g();break;case 13:null==e.onEnterPressed||t.shiftKey?o():e.onEnterPressed();break;case 35:f(t.ctrlKey?"end":"lineEnd",t.shiftKey);break;case 36:f(t.ctrlKey?"start":"lineStart",t.shiftKey);break;case 37:f("left",t.shiftKey);break;case 38:f("up",t.shiftKey);break;case 39:f("right",t.shiftKey);break;case 40:f("down",t.shiftKey);break;case 46:i();break;case 65:if(!t.ctrlKey)return;b();break;default:return}return t.preventDefault(),null!=e.onChange?e.onChange(h):void 0},document.addEventListener("keypress",v),document.addEventListener("keydown",d),t.addEventListener("mousedown",u.down),t.addEventListener("mousemove",u.move),t.addEventListener("mouseup",u.up),t.addEventListener("mouseleave",u.up),f("end"),{repaint:p,text:function(){return h.join("\n")},dispose:function(){document.removeEventListener("keypress",v),document.removeEventListener("keydown",d),t.removeEventListener("mousedown",u.down),t.removeEventListener("mousemove",u.move),t.removeEventListener("mouseup",u.up),t.removeEventListener("mouseleave",u.up),clearInterval(y),p(!1)}}}()},module.exports={field:canvastext,draw:drawtext};

},{"./fontHeight":2,"./selectedText":3}],2:[function(require,module,exports){
module.exports=function(e){var t,d,n,o;return t=document.getElementsByTagName("body")[0],d=document.createElement("div"),n=document.createTextNode("M"),d.appendChild(n),d.setAttribute("style",e),t.appendChild(d),o=d.offsetHeight,t.removeChild(d),o};

},{}],3:[function(require,module,exports){
var fontHeight;fontHeight=require("./fontHeight"),module.exports=function(){var e,t,r;return e={start:{line:0,character:0},end:{line:0,character:0}},r=function(){var t,r,n;return r=e.start,t=e.end,(t.line<r.line||t.line===r.line&&t.character<r.character)&&(n=t,t=r,r=n),{start:{line:r.line,character:r.character},end:{line:t.line,character:t.character}}},t=function(){return e.start.line===e.end.line&&e.start.character===e.end.character},{setStart:function(t){return e.start={line:t.line,character:t.character}},setEnd:function(t){return e.end={line:t.line,character:t.character}},getStart:function(){return{line:e.start.line,character:e.start.character}},getEnd:function(){return{line:e.end.line,character:e.end.character}},getText:function(t){var r,n,a,c,i,l,u;for(u=[],l=e.start,r=e.end,a=n=c=l.line,i=r.line;i>=c?i>=n:n>=i;a=i>=c?++n:--n)a===l.line?u.push(t[a].substr(l.character)):a===r.line?u.push(t[a].slice(0,-r.character)):u.push(t[a]);return u.join("\n")},normalize:r,isEmpty:t,mark:function(e,n,a,c,i){var l,u,h,o,s,f,d,g,p,m,x,v,y;if(f=r(),y=f.start,u=f.end,!t()){for(n.save(),s=fontHeight("font: "+n.font),d=function(e,t){return{x:n.measureText(i[e].slice(0,t)).width+a,y:e*s+c}},v=function(e){return e>y.line?0:y.character},x=function(e){return e<u.line?i[e].length:u.character},n.fillStyle="lightblue",n.globalCompositeOperation="multiply",o=h=g=y.line,p=u.line;p>=g?p>=h:h>=p;o=p>=g?++h:--h)m=d(o,v(o)),l=d(o,x(o)),n.fillRect(m.x,m.y,l.x-m.x,s);return n.restore()}}}};

},{"./fontHeight":2}]},{},[1])(1)
});